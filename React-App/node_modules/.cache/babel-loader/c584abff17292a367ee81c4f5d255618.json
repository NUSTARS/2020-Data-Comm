{"ast":null,"code":"const {\n  promisify\n} = require('util');\n\nconst binding = require('bindings')('bindings.node');\n\nconst AbstractBinding = require('@serialport/binding-abstract');\n\nconst Poller = require('./poller');\n\nconst unixRead = require('./unix-read');\n\nconst unixWrite = require('./unix-write');\n\nconst {\n  wrapWithHiddenComName\n} = require('./legacy');\n\nconst defaultBindingOptions = Object.freeze({\n  vmin: 1,\n  vtime: 0\n});\nconst asyncList = promisify(binding.list);\nconst asyncOpen = promisify(binding.open);\nconst asyncClose = promisify(binding.close);\nconst asyncUpdate = promisify(binding.update);\nconst asyncSet = promisify(binding.set);\nconst asyncGet = promisify(binding.get);\nconst asyncGetBaudRate = promisify(binding.getBaudRate);\nconst asyncDrain = promisify(binding.drain);\nconst asyncFlush = promisify(binding.flush);\n/**\n * The Darwin binding layer for OSX\n */\n\nclass DarwinBinding extends AbstractBinding {\n  static list() {\n    return wrapWithHiddenComName(asyncList());\n  }\n\n  constructor(opt = {}) {\n    super(opt);\n    this.bindingOptions = { ...defaultBindingOptions,\n      ...opt.bindingOptions\n    };\n    this.fd = null;\n    this.writeOperation = null;\n  }\n\n  get isOpen() {\n    return this.fd !== null;\n  }\n\n  async open(path, options) {\n    await super.open(path, options);\n    this.openOptions = { ...this.bindingOptions,\n      ...options\n    };\n    const fd = await asyncOpen(path, this.openOptions);\n    this.fd = fd;\n    this.poller = new Poller(fd);\n  }\n\n  async close() {\n    await super.close();\n    const fd = this.fd;\n    this.poller.stop();\n    this.poller.destroy();\n    this.poller = null;\n    this.openOptions = null;\n    this.fd = null;\n    return asyncClose(fd);\n  }\n\n  async read(buffer, offset, length) {\n    await super.read(buffer, offset, length);\n    return unixRead({\n      binding: this,\n      buffer,\n      offset,\n      length\n    });\n  }\n\n  async write(buffer) {\n    this.writeOperation = super.write(buffer).then(async () => {\n      if (buffer.length === 0) {\n        return;\n      }\n\n      await unixWrite({\n        binding: this,\n        buffer\n      });\n      this.writeOperation = null;\n    });\n    return this.writeOperation;\n  }\n\n  async update(options) {\n    await super.update(options);\n    return asyncUpdate(this.fd, options);\n  }\n\n  async set(options) {\n    await super.set(options);\n    return asyncSet(this.fd, options);\n  }\n\n  async get() {\n    await super.get();\n    return asyncGet(this.fd);\n  }\n\n  async getBaudRate() {\n    await super.get();\n    return asyncGetBaudRate(this.fd);\n  }\n\n  async drain() {\n    await super.drain();\n    await this.writeOperation;\n    return asyncDrain(this.fd);\n  }\n\n  async flush() {\n    await super.flush();\n    return asyncFlush(this.fd);\n  }\n\n}\n\nmodule.exports = DarwinBinding;","map":{"version":3,"sources":["/Users/Nathan/Desktop/data-comm-ui/node_modules/@serialport/bindings/lib/darwin.js"],"names":["promisify","require","binding","AbstractBinding","Poller","unixRead","unixWrite","wrapWithHiddenComName","defaultBindingOptions","Object","freeze","vmin","vtime","asyncList","list","asyncOpen","open","asyncClose","close","asyncUpdate","update","asyncSet","set","asyncGet","get","asyncGetBaudRate","getBaudRate","asyncDrain","drain","asyncFlush","flush","DarwinBinding","constructor","opt","bindingOptions","fd","writeOperation","isOpen","path","options","openOptions","poller","stop","destroy","read","buffer","offset","length","write","then","module","exports"],"mappings":"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","sourcesContent":["const { promisify } = require('util')\nconst binding = require('bindings')('bindings.node')\nconst AbstractBinding = require('@serialport/binding-abstract')\nconst Poller = require('./poller')\nconst unixRead = require('./unix-read')\nconst unixWrite = require('./unix-write')\nconst { wrapWithHiddenComName } = require('./legacy')\n\nconst defaultBindingOptions = Object.freeze({\n  vmin: 1,\n  vtime: 0,\n})\n\nconst asyncList = promisify(binding.list)\nconst asyncOpen = promisify(binding.open)\nconst asyncClose = promisify(binding.close)\nconst asyncUpdate = promisify(binding.update)\nconst asyncSet = promisify(binding.set)\nconst asyncGet = promisify(binding.get)\nconst asyncGetBaudRate = promisify(binding.getBaudRate)\nconst asyncDrain = promisify(binding.drain)\nconst asyncFlush = promisify(binding.flush)\n\n/**\n * The Darwin binding layer for OSX\n */\nclass DarwinBinding extends AbstractBinding {\n  static list() {\n    return wrapWithHiddenComName(asyncList())\n  }\n\n  constructor(opt = {}) {\n    super(opt)\n    this.bindingOptions = { ...defaultBindingOptions, ...opt.bindingOptions }\n    this.fd = null\n    this.writeOperation = null\n  }\n\n  get isOpen() {\n    return this.fd !== null\n  }\n\n  async open(path, options) {\n    await super.open(path, options)\n    this.openOptions = { ...this.bindingOptions, ...options }\n    const fd = await asyncOpen(path, this.openOptions)\n    this.fd = fd\n    this.poller = new Poller(fd)\n  }\n\n  async close() {\n    await super.close()\n    const fd = this.fd\n    this.poller.stop()\n    this.poller.destroy()\n    this.poller = null\n    this.openOptions = null\n    this.fd = null\n    return asyncClose(fd)\n  }\n\n  async read(buffer, offset, length) {\n    await super.read(buffer, offset, length)\n    return unixRead({ binding: this, buffer, offset, length })\n  }\n\n  async write(buffer) {\n    this.writeOperation = super.write(buffer).then(async () => {\n      if (buffer.length === 0) {\n        return\n      }\n      await unixWrite({ binding: this, buffer })\n      this.writeOperation = null\n    })\n    return this.writeOperation\n  }\n\n  async update(options) {\n    await super.update(options)\n    return asyncUpdate(this.fd, options)\n  }\n\n  async set(options) {\n    await super.set(options)\n    return asyncSet(this.fd, options)\n  }\n\n  async get() {\n    await super.get()\n    return asyncGet(this.fd)\n  }\n\n  async getBaudRate() {\n    await super.get()\n    return asyncGetBaudRate(this.fd)\n  }\n\n  async drain() {\n    await super.drain()\n    await this.writeOperation\n    return asyncDrain(this.fd)\n  }\n\n  async flush() {\n    await super.flush()\n    return asyncFlush(this.fd)\n  }\n}\n\nmodule.exports = DarwinBinding\n"]},"metadata":{},"sourceType":"script"}