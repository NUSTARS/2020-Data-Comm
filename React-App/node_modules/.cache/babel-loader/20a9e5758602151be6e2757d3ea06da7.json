{"ast":null,"code":"import { useContext, useRef, useReducer } from 'react';\nimport { useIsomorphicLayoutEffect } from './utils';\nimport { STATE_CONTEXT_PROPERTY, VERSION_CONTEXT_PROPERTY, SUBSCRIBE_CONTEXT_PROPERTY } from './createProvider';\nconst EQUALITY_FN_PROPERTY = 'e';\nconst SELECTOR_PROPERTY = 'r';\nconst STATE_PROPERTY = 's';\nconst SELECTED_PROPERTY = 'l';\n\nconst defaultEqualityFn = (a, b) => a === b;\n\nexport const createUseSelector = context => {\n  const useSelector = (selector, equalityFn = defaultEqualityFn) => {\n    const {\n      [STATE_CONTEXT_PROPERTY]: state,\n      [VERSION_CONTEXT_PROPERTY]: version,\n      [SUBSCRIBE_CONTEXT_PROPERTY]: subscribe\n    } = useContext(context);\n    const selected = selector(state);\n    const ref = useRef();\n    useIsomorphicLayoutEffect(() => {\n      ref.current = {\n        [EQUALITY_FN_PROPERTY]: equalityFn,\n        [SELECTOR_PROPERTY]: selector,\n        [STATE_PROPERTY]: state,\n        [SELECTED_PROPERTY]: selected\n      };\n    });\n    const [, checkUpdate] = useReducer((c, v) => {\n      if (version < v) {\n        return c + 1; // schedule update\n      }\n\n      try {\n        const refCurrent = ref.current;\n\n        if (refCurrent[STATE_PROPERTY] === state || refCurrent[EQUALITY_FN_PROPERTY](refCurrent[SELECTED_PROPERTY], refCurrent[SELECTOR_PROPERTY](state))) {\n          // not changed\n          return c; // bail out\n        }\n      } catch (e) {// ignored (stale props or some other reason)\n      }\n\n      return c + 1;\n    }, 0);\n    useIsomorphicLayoutEffect(() => {\n      const callback = (nextVersion, nextState) => {\n        try {\n          const refCurrent = ref.current;\n\n          if (nextState && (refCurrent[STATE_PROPERTY] === nextState || refCurrent[EQUALITY_FN_PROPERTY](refCurrent[SELECTED_PROPERTY], refCurrent[SELECTOR_PROPERTY](nextState)))) {\n            // not changed\n            return;\n          }\n        } catch (e) {// ignored (stale props or some other reason)\n        }\n\n        checkUpdate(nextVersion);\n      };\n\n      const unsubscribe = subscribe(callback);\n      return unsubscribe;\n    }, [subscribe]);\n    return selected;\n  };\n\n  return useSelector;\n};","map":{"version":3,"sources":["/Users/Nathan/Desktop/data-comm-ui/node_modules/react-tracked/src/createUseSelector.js"],"names":["useContext","useRef","useReducer","useIsomorphicLayoutEffect","STATE_CONTEXT_PROPERTY","VERSION_CONTEXT_PROPERTY","SUBSCRIBE_CONTEXT_PROPERTY","EQUALITY_FN_PROPERTY","SELECTOR_PROPERTY","STATE_PROPERTY","SELECTED_PROPERTY","defaultEqualityFn","a","b","createUseSelector","context","useSelector","selector","equalityFn","state","version","subscribe","selected","ref","current","checkUpdate","c","v","refCurrent","e","callback","nextVersion","nextState","unsubscribe"],"mappings":"AAAA,SACEA,UADF,EAEEC,MAFF,EAGEC,UAHF,QAIO,OAJP;AAMA,SAASC,yBAAT,QAA0C,SAA1C;AACA,SACEC,sBADF,EAEEC,wBAFF,EAGEC,0BAHF,QAIO,kBAJP;AAMA,MAAMC,oBAAoB,GAAG,GAA7B;AACA,MAAMC,iBAAiB,GAAG,GAA1B;AACA,MAAMC,cAAc,GAAG,GAAvB;AACA,MAAMC,iBAAiB,GAAG,GAA1B;;AAEA,MAAMC,iBAAiB,GAAG,CAACC,CAAD,EAAIC,CAAJ,KAAUD,CAAC,KAAKC,CAA1C;;AAEA,OAAO,MAAMC,iBAAiB,GAAIC,OAAD,IAAa;AAC5C,QAAMC,WAAW,GAAG,CAClBC,QADkB,EAElBC,UAAU,GAAGP,iBAFK,KAGf;AACH,UAAM;AACJ,OAACP,sBAAD,GAA0Be,KADtB;AAEJ,OAACd,wBAAD,GAA4Be,OAFxB;AAGJ,OAACd,0BAAD,GAA8Be;AAH1B,QAIFrB,UAAU,CAACe,OAAD,CAJd;AAKA,UAAMO,QAAQ,GAAGL,QAAQ,CAACE,KAAD,CAAzB;AACA,UAAMI,GAAG,GAAGtB,MAAM,EAAlB;AACAE,IAAAA,yBAAyB,CAAC,MAAM;AAC9BoB,MAAAA,GAAG,CAACC,OAAJ,GAAc;AACZ,SAACjB,oBAAD,GAAwBW,UADZ;AAEZ,SAACV,iBAAD,GAAqBS,QAFT;AAGZ,SAACR,cAAD,GAAkBU,KAHN;AAIZ,SAACT,iBAAD,GAAqBY;AAJT,OAAd;AAMD,KAPwB,CAAzB;AAQA,UAAM,GAAGG,WAAH,IAAkBvB,UAAU,CAAC,CAACwB,CAAD,EAAIC,CAAJ,KAAU;AAC3C,UAAIP,OAAO,GAAGO,CAAd,EAAiB;AACf,eAAOD,CAAC,GAAG,CAAX,CADe,CACD;AACf;;AACD,UAAI;AACF,cAAME,UAAU,GAAGL,GAAG,CAACC,OAAvB;;AACA,YAAII,UAAU,CAACnB,cAAD,CAAV,KAA+BU,KAA/B,IACCS,UAAU,CAACrB,oBAAD,CAAV,CACDqB,UAAU,CAAClB,iBAAD,CADT,EAEDkB,UAAU,CAACpB,iBAAD,CAAV,CAA8BW,KAA9B,CAFC,CADL,EAIK;AACH;AACA,iBAAOO,CAAP,CAFG,CAEO;AACX;AACF,OAVD,CAUE,OAAOG,CAAP,EAAU,CACV;AACD;;AACD,aAAOH,CAAC,GAAG,CAAX;AACD,KAlBiC,EAkB/B,CAlB+B,CAAlC;AAmBAvB,IAAAA,yBAAyB,CAAC,MAAM;AAC9B,YAAM2B,QAAQ,GAAG,CAACC,WAAD,EAAcC,SAAd,KAA4B;AAC3C,YAAI;AACF,gBAAMJ,UAAU,GAAGL,GAAG,CAACC,OAAvB;;AACA,cAAIQ,SAAS,KAAKJ,UAAU,CAACnB,cAAD,CAAV,KAA+BuB,SAA/B,IACbJ,UAAU,CAACrB,oBAAD,CAAV,CACDqB,UAAU,CAAClB,iBAAD,CADT,EAEDkB,UAAU,CAACpB,iBAAD,CAAV,CAA8BwB,SAA9B,CAFC,CADQ,CAAb,EAIM;AACJ;AACA;AACD;AACF,SAVD,CAUE,OAAOH,CAAP,EAAU,CACV;AACD;;AACDJ,QAAAA,WAAW,CAACM,WAAD,CAAX;AACD,OAfD;;AAgBA,YAAME,WAAW,GAAGZ,SAAS,CAACS,QAAD,CAA7B;AACA,aAAOG,WAAP;AACD,KAnBwB,EAmBtB,CAACZ,SAAD,CAnBsB,CAAzB;AAoBA,WAAOC,QAAP;AACD,GA3DD;;AA4DA,SAAON,WAAP;AACD,CA9DM","sourcesContent":["import {\n  useContext,\n  useRef,\n  useReducer,\n} from 'react';\n\nimport { useIsomorphicLayoutEffect } from './utils';\nimport {\n  STATE_CONTEXT_PROPERTY,\n  VERSION_CONTEXT_PROPERTY,\n  SUBSCRIBE_CONTEXT_PROPERTY,\n} from './createProvider';\n\nconst EQUALITY_FN_PROPERTY = 'e';\nconst SELECTOR_PROPERTY = 'r';\nconst STATE_PROPERTY = 's';\nconst SELECTED_PROPERTY = 'l';\n\nconst defaultEqualityFn = (a, b) => a === b;\n\nexport const createUseSelector = (context) => {\n  const useSelector = (\n    selector,\n    equalityFn = defaultEqualityFn,\n  ) => {\n    const {\n      [STATE_CONTEXT_PROPERTY]: state,\n      [VERSION_CONTEXT_PROPERTY]: version,\n      [SUBSCRIBE_CONTEXT_PROPERTY]: subscribe,\n    } = useContext(context);\n    const selected = selector(state);\n    const ref = useRef();\n    useIsomorphicLayoutEffect(() => {\n      ref.current = {\n        [EQUALITY_FN_PROPERTY]: equalityFn,\n        [SELECTOR_PROPERTY]: selector,\n        [STATE_PROPERTY]: state,\n        [SELECTED_PROPERTY]: selected,\n      };\n    });\n    const [, checkUpdate] = useReducer((c, v) => {\n      if (version < v) {\n        return c + 1; // schedule update\n      }\n      try {\n        const refCurrent = ref.current;\n        if (refCurrent[STATE_PROPERTY] === state\n          || refCurrent[EQUALITY_FN_PROPERTY](\n            refCurrent[SELECTED_PROPERTY],\n            refCurrent[SELECTOR_PROPERTY](state),\n          )) {\n          // not changed\n          return c; // bail out\n        }\n      } catch (e) {\n        // ignored (stale props or some other reason)\n      }\n      return c + 1;\n    }, 0);\n    useIsomorphicLayoutEffect(() => {\n      const callback = (nextVersion, nextState) => {\n        try {\n          const refCurrent = ref.current;\n          if (nextState && (refCurrent[STATE_PROPERTY] === nextState\n            || refCurrent[EQUALITY_FN_PROPERTY](\n              refCurrent[SELECTED_PROPERTY],\n              refCurrent[SELECTOR_PROPERTY](nextState),\n            ))) {\n            // not changed\n            return;\n          }\n        } catch (e) {\n          // ignored (stale props or some other reason)\n        }\n        checkUpdate(nextVersion);\n      };\n      const unsubscribe = subscribe(callback);\n      return unsubscribe;\n    }, [subscribe]);\n    return selected;\n  };\n  return useSelector;\n};\n"]},"metadata":{},"sourceType":"module"}